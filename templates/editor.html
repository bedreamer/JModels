
<!DOCTYPE html>
<html>
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>JModels-编辑</title>

  <!--- Site CSS -->
  <link rel="stylesheet" type="text/css" href="/static/semantic/semantic.css">
  <script src="/static/js/jquery.js"></script>
  <script src="/static/semantic/semantic.js"></script>
    <script src="/static/js/jmodels/jmodels.js" type="text/javascript"></script>
    <script src="/static/js/jmodels/jmodels-editor.js" type="text/javascript"></script>

  <!--- Example CSS -->
  <style>
  body {
    padding: 1em;
  }
  .ui.menu {
    margin: 3em 0em;
  }
  .ui.menu:last-child {
    margin-bottom: 110px;
  }
  </style>

  <!--- Example Javascript -->
  <script>
      var begin_index = -5;

  $(document)
    .ready(function() {
      $('.ui.menu .ui.dropdown').dropdown({
        on: 'hover'
      });
      $('.ui.menu a.item')
        .on('click', function() {
          $(this)
            .addClass('active')
            .siblings()
            .removeClass('active');
        });

        $("#id_plus").click(function () {
            begin_index ++;
        });

        $("#id_sub").click(function () {
            begin_index --;
        });

        var painter = new JPaintbord('paint', 1000, 600, {});
        var editor = new JEditor(painter);

        $.getJSON("/json/", '', function (data, status, xhr) {
            editor.load(data);
            editor.update();
        });

        $("#id_save").click(function () {
            var obj = editor.save();
            $.post("/json/", JSON.stringify(obj), function () {
            });
        });

        $("#menu_new_model").click(function () {
            document.ondblclick = function (ev) {
                document.ondblclick = null;
                editor.create_model(ev.offsetX, ev.offsetY, 80, 80, {});
                editor.update();
                console.info(ev);
            }
        });

        $("#menu_new_link").click(function () {
            $('#id_model_link').modal('show');
        });

        $("#id_create_confirm").click(function () {
            $('#id_model_model').modal('hide');
            var offset_x = $("input[name=offset_x]").val();
            var offset_y = $("input[name=offset_y]").val();
            var width = $("input[name=width]").val();
            var height = $("input[name=height]").val();
            editor.create_model(Number(offset_x), Number(offset_y), Number(width), Number(height), {});
            editor.update();
        });

        $("#id_link_confirm").click(function () {
            $('#id_model_link').modal('hide');
            var begin = $("input[name=begin]").val();
            var end = $("input[name=end]").val();

            if ( begin !== end ) {
                editor.create_link(begin, end, {});
                editor.update();
            }
        });

    });
  </script>
</head>
<body>

<div class="ui fluid menu">
  <div class="header item">JModels-编辑</div>
  <div class="ui dropdown item">
    模型
    <i class="dropdown icon"></i>
    <div class="menu">
      <div class="item" id="menu_new_model">新建模型</div>
      <div class="item" id="menu_new_link">新建连接</div>
      <div class="item" id="menu_new_segment">新建线段</div>
    </div>
  </div>
  <div class="right menu">
    <a class="item" id="id_plus">
        <button class="ui button green">
            <i class="save icon"></i>
            增加
        </button>
    </a>
    <a class="item" id="id_sub">
        <button class="ui button green">
            <i class="save icon"></i>
            减弱
        </button>
    </a>

    <a class="item" id="id_save">
        <button class="ui button green">
            <i class="save icon"></i>
            保存
        </button>
    </a>
  <a class="item" href="/preview/">
        <button class="ui button blue">
            <i class="eye icon"></i>
            预览
        </button>
    </a>
  </div>
</div>


<div class="ui modal" id="id_model_model">
  <div class="header">新建节点</div>
  <div class="scrolling content">
        <div class="ui input focus">
          <input type="number" name="offset_x" placeholder="偏移-X">
        </div>
        <div class="ui input focus">
          <input type="number" name="offset_y" placeholder="偏移-Y">
        </div>
        <div class="ui input focus">
          <input type="number" name="width" placeholder="宽" value="80">
        </div>
        <div class="ui input focus">
          <input type="number" name="height" placeholder="高" value="80">
        </div>
        <div class="ui button primary" id="id_create_confirm">
            <i class="plus icon"></i>
            新建
        </div>
  </div>
</div>

<div class="ui modal" id="id_model_link">
  <div class="header">新建链接</div>
  <div class="scrolling content">
        <div class="ui input focus">
          <input type="number" name="begin" placeholder="起始锚点">
        </div>
        <div class="ui input focus">
          <input type="number" name="end" placeholder="终止锚点">
        </div>
        <div class="ui button primary" id="id_link_confirm">
            <i class="plus icon"></i>
            新建
        </div>
  </div>
</div>

<canvas id="paint"></canvas>


</body>
</html>
